---
title: "DSFinal"
author: "Dhairya, Varun, Siddhartha, Subham"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)

library(treemap)



library(ggplot2)
```

```         
DataSet origin: https://archive.ics.uci.edu/dataset/2/adult
```

```{r}
# Read the dataset from the URL
data <- read.csv("https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.data")
```

```{r}
#cleaning Data
data <- data %>% rename(age = X39,workclass = State.gov,final_weight = X77516,education = Bachelors,education_num = X13,maritial_status = Never.married, relationship = Not.in.family, occupation = Adm.clerical, race = White, sex = Male,capital_gain = X2174,capital_loss = X0,hours_per_week = X40, native_country = United.States, income = X..50K)

#trim data values
data <- data %>%
  mutate(across(everything(), trimws))

#change ? values to NA
data <- data %>%mutate(
  workclass = ifelse(workclass == "?",NA,workclass),
  occupation = ifelse(occupation == "?",NA,occupation),
  native_country = ifelse(native_country == "?",NA,native_country)) 

#reorder education column values
data$education <- factor(data$education, levels = c("Preschool", "1st-4th", "5th-6th", "7th-8th", "9th", "10th", "11th", "12th", "HS-grad", "Some-college", "Assoc-acdm", "Assoc-voc", "Bachelors", "Masters", "Prof-school", "Doctorate"))

#changing datatype
data$occupation <- as.factor(data$occupation)
data$workclass <- as.factor(data$workclass)
data$maritial_status <- as.factor(data$maritial_status)
data$relationship <- as.factor(data$relationship)
data$sex <- as.factor(data$sex)
data$race <- as.factor(data$race)
data$native_country <- as.factor(data$native_country)
data$income <- as.factor(data$income)


data$age <- as.numeric(data$age)
data$education_num <- as.numeric(data$education_num)
data$capital_gain <- as.numeric(data$capital_gain)
data$capital_loss <- as.numeric(data$capital_loss)
data$hours_per_week <- as.numeric(data$hours_per_week)

```

```         
The paramters are:

age: the age of an individual
workclass: a general term to represent the employment status of an individual
final_weight: final weight. This is the number of people the census believes the entry represents..
education: the highest level of education achieved by an individual.
education_num: the highest level of education achieved in numerical form.
marital_status: marital status of an individual.
occupation: the general type of occupation of an individual
relationship: represents what this individual is relative to others.
race: Descriptions of an individualâ€™s race
sex: the sex of the individual
capital_gain: capital gains for an individual
capital_loss: capital loss for an individual
hours_per_week: the hours an individual has reported to work per week
native_country: country of origin for an individual
income: if the income of that person is less than or greater than 50,000
```

```{r}
summary(data)
```

```         
This shows that there are no missing values in the dataset, besides occupation,workclass and native_country which has certain missing values.
```

```{r}

#density plot for age
ggplot(data, aes(x = age)) +
  geom_bar(fill = "lightblue") +
  labs(x = "Age", y = "Count") +
  theme_minimal()
```

```         
This bar plot is left skewed which shows that majority of the working population in ranging from 20 to 50. 
```
```{r}
#demographics of the working population
custom_fill_colors <- c("Female" = "pink", "Male" = "lightblue")

ggplot(data, aes(x = race, fill = sex)) +
  geom_bar(position = "dodge", color = "black", alpha = 0.7) +
  geom_text(aes(label = ..count..), stat = "count", position =
                position_dodge(width = 0.9), vjust = -0.5) +
  labs(title = "Demographic distribution based on Sex & Race",
       x = "Race", y = "Count (log10)") +
  scale_y_continuous(trans = "log10", labels = scales::comma_format()) +
  scale_fill_manual(values = custom_fill_colors) +
  theme_minimal() +
  theme(legend.position = "top")
```

```{}
This bar chart shows the demographic destribution of the population in the US. Most of the people are White with the second most being Black where the difference is more than 15000 in observations. Also the number of white men is more than double that of white women for this dataset. We cant exactly say that this would represent the actual population but it could also say that the majority  of the people who were observed were White.
```

```{r}

data <- data %>%
  group_by(native_country) %>%
  mutate(count_native_country = n())
data$log_count_native_country <- log(data$count_native_country +1) * 100  # Adding 1 to handle cases where count is 0

# Create a treemap
treemap(data,
        index = c("native_country"),
        vSize = "log_count_native_country",
        title = "Treemap of Native Country (Log Scale)",
        palette = "Dark2",
        border.col = "black",
        border.lwds = 1,
        fontsize.labels = 12,
        fontcolor.labels = "black",
        align.labels = c("left", "top"),
        overlap.labels = 0,
        inflate.labels = TRUE        )
```

```{r}
#number of observations where income <=50K
print(sum(data$income == "<=50K"))

#number of observations where income >50K
print(sum(data$income == ">50K"))
```

```{r}
ggplot(data, aes(x = education, fill = income)) +
  geom_bar(position = "fill") +
  labs(title = "Education Level V/S Income",x = "Education Level", y = "Proportion", fill = "Income") +
  theme_minimal()+
  theme(axis.text.x = element_text(angle =45,hjust=1))
```

```{}         
The above bar plot decribes the relation between Education Level and Income. The income values are of two type, <=50K and >50K. Majority of the population distribution has income less that 50K. percentage of population that has income <=50K is (24719/32560)*100 = 75.9%. However, from the bar plot we can see that as the level of education increases, the proportion of income shifts towards income levels greater than 50K. That is the ratio of >50K to <=50K increases. we can also see that for individuals with education level of Masters, Prof-school and Doctorate more than 50% of them have an income >50K. 
```

```{r}
ggplot(data, aes(x=workclass,fill=income))+
  geom_bar(position = "fill")+
  labs(title = "Workclass V/S Income",x = "Workclass", y = "Proportion", fill = "Income")+
  theme(axis.text.x = element_text(angle=45,hjust=1))
```

```{}
From this graph we can see that majority of the people work in private sector. And majority of the people in the private sector earn less than 50k. Another analysis that we can do from this is that almost all workclass categories have more people earning less than 50K with the only exception of self employed. There are more people earning >50K.
```

```{r}
ggplot(data, aes(x=maritial_status,fill=income))+
  geom_bar(position = "fill")+
  labs(title = "maritial status V/S Income",x = "maritial status", y = "Proportion", fill = "Income")+
  theme(axis.text.x = element_text(angle=45,hjust=1))
```
```{r}
ggplot(data, aes(x=relationship,fill=income))+
  geom_bar(position = "fill")+
  labs(title = "relationship V/S Income",x = "relationship", y = "Proportion", fill = "Income")+
  theme(axis.text.x = element_text(angle=45,hjust=1))
```

```{}
From these two graphs we can observe that families that are together have a better income proportion that is they generally earn much more than families that are seperated, divorced or widowed. Even the scenerio where they are married but spouse is absent shows that they have a worse proportion. 
The data is observered to be consistant with the relationships column. Husbands and wives have a better proportion than any other. Also [Own - child] refers to individuals who have never married but have a child. Thus individuals with spouses have a better income.
```

```{r}
# Create facetted plot with clearer labels
library(ggplot2)

# Assuming 'data' is your dataset
# Loop through each unique race
for(race in unique(data$race)) {
  # Filter the data for one race at a time
  race_data <- data[data$race == race, ]
  
  # Plotting
  p <- ggplot(race_data, aes(x = occupation)) +
    geom_bar() +
    labs(
      title = paste("Occupation Distribution for", toupper(race)),
      x = "Occupation",
      y = "Count"
    ) +
    theme_minimal() +
    theme(
      axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for better readability
      plot.title = element_text(size = 14, face = "bold")  # Bold and larger title
    )
  
  # Print the plot
  print(p)
}
```

```{r}
library(ggplot2)

# Plotting
ggplot(data, aes(x = sex, fill = income)) +
  geom_bar(position = "fill") +
  labs(
    title = "Sex vs. Income",
    x = "Sex",
    y = "Proportion",
    fill = "Income"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 0.5),
    legend.position = "top"
  )

```

Occupation vs. Income:
```{r}
# Plotting
ggplot(data, aes(x = occupation, fill = income)) +
  geom_bar(position = "fill") +
  labs(
    title = "Occupation vs. Income",
    x = "Occupation",
    y = "Proportion",
    fill = "Income"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top"
  )

```

Native Country vs. Income
```{r}
# Plotting
ggplot(data, aes(x = native_country, fill = income)) +
  geom_bar(position = "fill") +
  labs(
    title = "Native Country vs. Income",
    x = "Native Country",
    y = "Proportion",
    fill = "Income"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top"
  )
```

Age Distribution by Income Level
```{r}
# Plotting
ggplot(data, aes(x = age, fill = income)) +
  geom_histogram(binwidth = 5, position = "fill", color = "black") +
  labs(
    title = "Age Distribution by Income Level",
    x = "Age",
    y = "Proportion",
    fill = "Income"
  ) +
  theme_minimal() +
  theme(legend.position = "top")

```

Education Level by Occupation
```{r}
# Plotting
ggplot(data, aes(x = occupation, fill = education)) +
  geom_bar(position = "fill") +
  labs(
    title = "Education Level by Occupation",
    x = "Occupation",
    y = "Proportion",
    fill = "Education Level"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top"
  )
```

Work Hours Distribution by Income Level
```{r}
# Plotting
ggplot(data, aes(x = hours_per_week, fill = income)) +
  geom_histogram(binwidth = 5, position = "fill", color = "black") +
  labs(
    title = "Work Hours Distribution by Income Level",
    x = "Hours per Week",
    y = "Proportion",
    fill = "Income"
  ) +
  theme_minimal() +
  theme(legend.position = "top")

```


Marital Status by Age
```{r}
# Plotting
ggplot(data, aes(x = age, fill = maritial_status)) +
  geom_histogram(binwidth = 5, position = "fill", color = "black") +
  labs(
    title = "Marital Status by Age",
    x = "Age",
    y = "Proportion",
    fill = "Marital Status"
  ) +
  theme_minimal() +
  theme(legend.position = "top")

```

Race/Ethnicity vs. Education Level
```{r}
# Plotting
ggplot(data, aes(x = education, fill = race)) +
  geom_bar(position = "fill") +
  labs(
    title = "Race/Ethnicity vs. Education Level",
    x = "Education Level",
    y = "Proportion",
    fill = "Race/Ethnicity"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top"
  )
```

Relationship Status by Occupation
```{r}
# Plotting
ggplot(data, aes(x = occupation, fill = relationship)) +
  geom_bar(position = "fill") +
  labs(
    title = "Relationship Status by Occupation",
    x = "Occupation",
    y = "Proportion",
    fill = "Relationship Status"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top"
  )

```

Income Distribution by Native Country
```{r}
# Plotting
ggplot(data, aes(x = native_country, fill = income)) +
  geom_bar(position = "fill") +
  labs(
    title = "Income Distribution by Native Country",
    x = "Native Country",
    y = "Proportion",
    fill = "Income"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top"
  )

```

sex vs income
occupation vs income
native country income

